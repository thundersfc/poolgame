<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Flappy Giant - poolix</title>
    <style>
        :root {
            --primary: #3498db;
            --bg: #0f172a;
            --surface: #1e293b;
            --accent: #f43f5e;
            --gold: #fbbf24;
        }
        body { 
            margin: 0; 
            padding: 0;
            display: flex; 
            flex-direction: column;
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            background: var(--bg); 
            font-family: 'Segoe UI', system-ui, sans-serif;
            color: white;
            overflow: hidden;
            touch-action: none;
        }
        #game-wrapper {
            position: relative;
            background: #000;
            border: 4px solid #334155;
            border-radius: 24px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.7);
            overflow: hidden;
            width: 95vw;
            max-width: 400px;
            aspect-ratio: 2/3;
        }
        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }
        .hud {
            position: absolute;
            top: 20px;
            width: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 5;
        }
        .score-container {
            background: rgba(0,0,0,0.4);
            backdrop-filter: blur(8px);
            padding: 5px 25px;
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.1);
            text-align: center;
        }
        .score { font-size: 52px; font-weight: 900; color: #fff; text-shadow: 0 4px 12px rgba(0,0,0,0.5); line-height: 1; }
        .weather-tag { font-size: 12px; text-transform: uppercase; letter-spacing: 2px; color: #60a5fa; font-weight: 800; margin-top: 4px; }
        .difficulty-tag { font-size: 14px; text-transform: uppercase; letter-spacing: 3px; color: var(--gold); font-weight: 800; margin-bottom: 4px; }
        
        #overlay {
            position: absolute;
            inset: 0;
            background: rgba(15, 23, 42, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
            text-align: center;
            padding: 30px;
        }

        /* Screenshot Template Styles */
        #game-over-card {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 30px;
            width: 80%;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
            display: none;
            flex-direction: column;
            align-items: center;
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .card-bird {
            width: 100px;
            height: 100px;
            margin-bottom: 15px;
            filter: drop-shadow(0 10px 15px rgba(0,0,0,0.3));
        }

        .card-score-label { font-size: 14px; color: #94a3b8; text-transform: uppercase; letter-spacing: 2px; }
        .card-score-val { font-size: 64px; font-weight: 900; color: #fff; margin: 5px 0; }

        .start-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 16px 40px;
            font-size: 20px;
            font-weight: 900;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 10px 25px rgba(244, 63, 94, 0.4);
            margin-top: 20px;
            -webkit-tap-highlight-color: transparent;
        }
        .start-btn:hover { transform: translateY(-2px); }
        .controls-hint { margin-top: 20px; font-size: 13px; color: #475569; font-weight: 500; }
    </style>
</head>
<body>

    <div id="game-wrapper">
        <div id="overlay">
            <div id="menu-content">
                <h2 style="font-size: 42px; margin: 0; background: linear-gradient(to right, #60a5fa, #f43f5e); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">FLAPPY GIANT</h2>
                <p style="color: #94a3b8; margin: 10px 0 30px;">Dynamic Weather Challenge</p>
                <button class="start-btn" onclick="startGame()">START GAME</button>
                <div class="controls-hint">Tap or Press Space to Fly</div>
            </div>

            <!-- Screenshot Mode Template -->
            <div id="game-over-card">
                <img id="card-bird-img" class="card-bird" src="bird.png" alt="Bird">
                <div class="card-score-label">Final Score</div>
                <div class="card-score-val" id="final-score-val">0</div>
                <div style="font-size: 12px; color: #475569; margin-bottom: 10px;">VARTA MAMEY DURRRR</div>
                <button class="start-btn" style="padding: 12px 30px; font-size: 16px;" onclick="startGame()">TRY AGAIN</button>
            </div>
        </div>

        <div class="hud">
            <div class="difficulty-tag" id="difficulty-val">EASY</div>
            <div class="score-container">
                <div class="score" id="score-val">0</div>
                <div class="weather-tag" id="weather-val">CLEAR</div>
            </div>
        </div>
        <canvas id="mainCanvas" width="400" height="600"></canvas>
    </div>

<script>
    const canvas = document.getElementById('mainCanvas');
    const ctx = canvas.getContext('2d');
    const scoreVal = document.getElementById('score-val');
    const diffVal = document.getElementById('difficulty-val');
    const weatherVal = document.getElementById('weather-val');
    const overlay = document.getElementById('overlay');
    const menuContent = document.getElementById('menu-content');
    const gameOverCard = document.getElementById('game-over-card');
    const finalScoreDisplay = document.getElementById('final-score-val');

    // --- Sound System ---
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playSfx(freq, type, duration, vol = 0.1) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(freq/4, audioCtx.currentTime + duration);
        gain.gain.setValueAtTime(vol, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.start(); osc.stop(audioCtx.currentTime + duration);
    }

    const birdImg = new Image();
    birdImg.src = 'bird.png';
    let birdLoaded = false;
    birdImg.onload = () => {
        birdLoaded = true;
        document.getElementById('card-bird-img').src = birdImg.src;
    };

    // Game Variables
    let isPlaying = false;
    let score = 0;
    let frame = 0;
    let entities = [];
    let particles = [];
    let weatherParticles = [];
    let player = { x: 50, y: 300, w: 130, h: 130, vy: 0 };
    let difficulty = 1;
    let weatherMode = 'CLEAR'; // CLEAR, RAIN, STORM
    let flashOpacity = 0;

    // Input Handling
    window.addEventListener('keydown', e => {
        if (['Space', 'ArrowUp', 'KeyW'].includes(e.code)) playerJump();
    });
    canvas.addEventListener('mousedown', playerJump);
    canvas.addEventListener('touchstart', (e) => {
        e.preventDefault();
        playerJump();
    }, {passive: false});

    function playerJump() {
        if (!isPlaying) return;
        // Storm mode makes jumping slightly heavier (wind)
        let jumpPower = weatherMode === 'STORM' ? -7.8 : -8.5;
        player.vy = jumpPower;
        playSfx(400, 'triangle', 0.1);
    }

    function resetGame() {
        score = 0; frame = 0; entities = []; particles = []; weatherParticles = []; 
        difficulty = 1; weatherMode = 'CLEAR'; flashOpacity = 0;
        scoreVal.innerText = "0"; diffVal.innerText = "EASY";
        weatherVal.innerText = "CLEAR";
        player.y = 200; player.vy = 0;
    }

    function startGame() {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        resetGame(); isPlaying = true;
        overlay.style.display = 'none';
        menuContent.style.display = 'flex';
        gameOverCard.style.display = 'none';
        requestAnimationFrame(update);
    }

    function gameOver() {
        if (!isPlaying) return;
        isPlaying = false;
        playSfx(120, 'sawtooth', 0.6, 0.2);
        
        // Show Screenshot Template
        overlay.style.display = 'flex';
        menuContent.style.display = 'none';
        gameOverCard.style.display = 'flex';
        finalScoreDisplay.innerText = score;
    }

    function updateWeather() {
        // Change weather based on score
        if (score >= 30) {
            if (weatherMode !== 'STORM') { weatherMode = 'STORM'; playSfx(50, 'sine', 1, 0.3); }
            weatherVal.innerText = "‚ö° STORM";
            weatherVal.style.color = "#f43f5e";
        } else if (score >= 10) {
            weatherMode = 'RAIN';
            weatherVal.innerText = "üåß RAIN";
            weatherVal.style.color = "#60a5fa";
        } else {
            weatherMode = 'CLEAR';
            weatherVal.innerText = "‚òÄÔ∏è CLEAR";
            weatherVal.style.color = "#fbbf24";
        }

        // Spawn weather effects
        if (weatherMode === 'RAIN' || weatherMode === 'STORM') {
            let density = weatherMode === 'STORM' ? 3 : 1;
            for(let i=0; i<density; i++) {
                weatherParticles.push({
                    x: Math.random() * canvas.width,
                    y: -10,
                    l: 10 + Math.random() * 20,
                    v: 10 + Math.random() * 10
                });
            }
        }

        // Random Lightning in Storm
        if (weatherMode === 'STORM' && Math.random() < 0.01) {
            flashOpacity = 0.5;
            playSfx(60, 'sawtooth', 0.4, 0.05);
        }
    }

    function drawWeather() {
        if (weatherMode === 'RAIN' || weatherMode === 'STORM') {
            ctx.strokeStyle = weatherMode === 'STORM' ? 'rgba(200, 230, 255, 0.4)' : 'rgba(174, 194, 224, 0.3)';
            ctx.lineWidth = 1;
            for(let i=weatherParticles.length-1; i>=0; i--) {
                let p = weatherParticles[i];
                ctx.beginPath();
                ctx.moveTo(p.x, p.y);
                ctx.lineTo(p.x - 2, p.y + p.l);
                ctx.stroke();
                p.y += p.v;
                p.x -= 2; // Wind effect
                if (p.y > canvas.height) weatherParticles.splice(i, 1);
            }
        }

        if (flashOpacity > 0) {
            ctx.fillStyle = `rgba(255, 255, 255, ${flashOpacity})`;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            flashOpacity *= 0.9;
        }
    }

    function updateParticles() {
        for(let i=particles.length-1; i>=0; i--) {
            let p = particles[i];
            p.x += p.vx; p.y += p.vy; p.life -= 0.03;
            if (p.life <= 0) particles.splice(i, 1);
            else {
                ctx.globalAlpha = p.life;
                ctx.fillStyle = p.color;
                ctx.beginPath(); ctx.arc(p.x, p.y, 4, 0, Math.PI*2); ctx.fill();
            }
        }
        ctx.globalAlpha = 1.0;
    }

    function updateDifficulty() {
        if (score >= 40) { difficulty = 2.2; diffVal.innerText = "OVERDRIVE"; diffVal.style.color = "#ff4444"; }
        else if (score >= 20) { difficulty = 1.6; diffVal.innerText = "VETERAN"; diffVal.style.color = "#f43f5e"; }
        else if (score >= 10) { difficulty = 1.3; diffVal.innerText = "PRO"; diffVal.style.color = "#3498db"; }
        else { difficulty = 1.0; diffVal.innerText = "ROOKIE"; diffVal.style.color = "#fbbf24"; }
    }

    function update() {
        if (!isPlaying) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        frame++;
        updateDifficulty();
        updateWeather();

        // Dynamic Background based on weather
        let bg1 = weatherMode === 'CLEAR' ? '#0ea5e9' : (weatherMode === 'RAIN' ? '#334155' : '#0f172a');
        let bg2 = weatherMode === 'CLEAR' ? '#38bdf8' : (weatherMode === 'RAIN' ? '#475569' : '#1e293b');
        let sky = ctx.createLinearGradient(0, 0, 0, canvas.height);
        sky.addColorStop(0, bg1); sky.addColorStop(1, bg2);
        ctx.fillStyle = sky; ctx.fillRect(0,0, canvas.width, canvas.height);

        // Physics
        player.vy += 0.45; player.y += player.vy;
        
        // Spawn Pipes
        let spawnRate = Math.max(35, 90 - (score * 2.5));
        if (frame % Math.floor(spawnRate) === 0) {
            let gap = Math.max(220, 300 - (score * 4)); 
            let h = Math.random() * (canvas.height - gap - 160) + 80;
            entities.push({ x: canvas.width, y: 0, w: 90, h: h, type: 'pipe' });
            entities.push({ x: canvas.width, y: h + gap, w: 90, h: canvas.height, type: 'pipe' });
        }

        // Update Pipes
        entities.forEach((p, i) => {
            p.x -= (4.5 * difficulty);
            
            let colorMain = weatherMode === 'STORM' ? '#3f3f46' : '#10b981';
            let colorMid = weatherMode === 'STORM' ? '#71717a' : '#34d399';
            
            let grad = ctx.createLinearGradient(p.x, 0, p.x + p.w, 0);
            grad.addColorStop(0, colorMain); grad.addColorStop(0.5, colorMid); grad.addColorStop(1, colorMain);
            ctx.fillStyle = grad;
            ctx.fillRect(p.x, p.y, p.w, p.h);
            ctx.strokeStyle = 'rgba(0,0,0,0.3)'; ctx.lineWidth = 4; ctx.strokeRect(p.x, p.y, p.w, p.h);

            // Collision
            const bx = 42; const by = 38;
            if (player.x + bx < p.x + p.w && player.x + player.w - bx > p.x &&
                player.y + by < p.y + p.h && player.y + player.h - by > p.y) {
                gameOver();
            }
            
            if (p.x + p.w < 0) {
                entities.splice(i, 1);
                if (i % 2 === 0) { 
                    score++; scoreVal.innerText = score; 
                    playSfx(800, 'sine', 0.1, 0.05); 
                }
            }
        });

        if (player.y + player.h > canvas.height || player.y < -200) gameOver();

        // Draw Weather particles behind player
        drawWeather();

        // Draw Player
        ctx.save();
        let rot = Math.min(Math.PI/4, Math.max(-Math.PI/4, player.vy * 0.1));
        ctx.translate(player.x + player.w/2, player.y + player.h/2);
        ctx.rotate(rot);
        if (birdLoaded) {
            ctx.drawImage(birdImg, -player.w/2, -player.h/2, player.w, player.h);
        } else {
            ctx.fillStyle = 'yellow'; ctx.fillRect(-player.w/2, -player.h/2, player.w, player.h);
        }
        ctx.restore();

        updateParticles();
        requestAnimationFrame(update);
    }
</script>
</body>
</html>
